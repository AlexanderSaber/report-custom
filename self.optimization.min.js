(function(i,t,e,s){"use strict";var n=function(i){i=i||{};this.posObj={};this.mmToPx=i.mmToPx||3;this.xx=0;this.yy=0;this.initializeElements();this.eventsMap={"dblclick .title":"titledblclick","dblclick .input input":"inputdbclick","click .input span":"changeFontSize","click .make-hr a":"makehr","click .change-paper a":"changepapaer","click #cusGo":"cusGo","click #toHtml":"toHtml","click #close":"close"};this.initialization()};n.Eles={widgetDiv:".left-widget div",inputResize:".input-resize",pap:".paper",centerY:".center-y",centerBox:".center-box",lineX:".line-x",lineY:".line-y",lineXY:".line-x .line-y",widgetUl:".left-widget ul",hr:".hr",txt:".input-group-btn button",cus:"#paper-type-cus",paperCusw:"#paper-cus-width",paperCush:"#paper-cus-height",hid:"#hidden",showHtmlCls:".showHtml",showHtmlId:"#showHtml",mainCon:"#mainCon",rulerX:".ruler-x",numX:".num-x",rulerY:".ruler-y",numY:".num-y"};n.prototype={constructor:n,_dragStart:function(i,t){var e=this.centerY;if(["titleDrag","subtitleDrag"].indexOf(i.target.id)>-1){var s=t.helper.width();var n=parseInt(e.css("left"),10);this.centerBox.removeClass("hidden").css({width:s,left:n-Math.floor(s/2)})}else{this.centerBox.addClass("hidden")}},_dragStop:function(i,e){var s=this.mmToPx,n=this.posObj,a=i.target,r=a.id,h=e.offset.top,l=e.offset.left,o=t(a).next(),d=a.find(".input-resize");if(this.paperRange(h,l)){n[r]={id:r,outerHTML:this.delStyle(a.outerHTML),style:"#"+r+"{"+this._getPositionLT(h,l,s)+"}"};if(["imgDescI","diagDescI"].indexOf(r)>-1){var c=parseInt(d.css("width"));var p=parseInt(d.css("height"));n[r].style="#"+r+"{"+this._getPositionLT(h,l,s)+"width:"+c/s+"mm;height:"+p/s+"mm}"}this._drawNextLine(o,l,h)}else{o.addClass("hidden")}this.lineXY.addClass("hidden")},_getPositionLT:function(i,t,e){return"position:absolute;left"+(t-260)/e+"mm;top"+(i-40)/e+"mm"},_drawNextLine:function(i,t,e){var s=this.pap,n=parseInt(s.css("height"),10),a=parseInt(s.css("width"),10),r=i.find(".line-left"),h=i.find(".line-top");i.removeClass("hidden");r.css({top:40,left:t,height:n,width:a-t+260+"px"});h.css({left:260,top:e,width:a,height:n-e+40+"px"})},_dragging:function(i,t){var e=this.xx,s=this.yy,n=i.target.id,a=t.offset.top,r=t.offset.left,h=t.helper.height(),l=t.helper.width();if(["titleDrag","subtitleDrag"].indexOf(n)>-1){e=a+Math.floor(h/2);s=r+Math.floor(l/2)}else{e=a;s=r}if(this.paperRange(e,s)){this.lineXY.removeClass("hidden");this.lineX.css("top",e);this.lineY.css("left",s)}else{this.lineXY.addClass("hidden")}},_resizing:function(i,e){var s=i.target;this.lineXY.removeClass("hidden");this.lineX.css("top",+e.size.height+t(s).offset().top);this.lineY.css("left",+e.size.width+t(s).offset().left)},_resizeStop:function(i,e){var s=this.mmToPx,n=this.posObj,a=i.target,r=a.id,h=t(a).offset(),l=h.left,o=h.top;this.lineXY.addClass("hidden");n[r].style="#"+r+"{"+this._getPositionLT(o,l,s)+";width:"+e.size.width/s+"mm;height:"+e.size.height/s+"mm}"},titledblclick:function(i){var e=i.target;t(e).toggleClass("hidden");t(e).next(".input").toggleClass("hidden")},inputdblclick:function(i){var e=i.target;var s=t(e).parent(".input");var n=s.prev();n.html(t(e).val());n.css("font-size",t(e).css("font-size"));s.toggleClass("hidden");n.toggleClass("hidden")},changeFontSize:function(i){var e=i.target;var s=t(e).parent(".input").find("input");var n=parseInt(s.css("font-size"));if(e.className=="glyphicon glyphicon-plus-sign"){n=parseInt(n)+1+"px"}else{n=parseInt(n)-1+"px"}s.css("font-size",n)},makehr:function(i){var t=this.widgetUl;var e;switch(i.target.id){case"thin":e='<li><div class="hr thin"></div></li>';t.append(e);break;case"middle":e='<li><div class="hr middle"></div></li>';t.append(e);break;case"thick":e='<li><div class="hr thick"></div></li>';t.append(e);break}this.initDrag();this.initHRResize()},initHRResize:function(){var i=this.xx;var t=this.yy;this.hr.resizable({handles:"e",minHeight:1,resize:function(e,s){this.lineXY.removeClass("hidden");this.lineX.css("top",+s.size.height+i);this.lineY.css("left",+s.size.width+t)},stop:function(){this.lineXY.addClass("hidden")}})},changepaper:function(i){var e=this.txt;var s=this.cus;var n=this.mmToPx;var a=this.pap;var r=t(i.target);e.text(r.text());switch(i.target.id){case"a4":a.css({width:210*n+"px",height:297*n+"px"});s.addClass("hidden");break;case"b5":a.css({width:176*n+"px",height:250*n+"px"});s.addClass("hidden");break;case"16k":a.css({width:184*n+"px",height:260*n+"px"});s.addClass("hidden");break;case"cus":s.removeClass("hidden");break}this.calLi()},cusGo:function(){var i=this.pap;var t=+this.paperCusw[0].value;var e=+this.paperCush[0].value;if(t&&e){i.css({width:t*3+"px",height:e*3+"px"});this.calLi()}},toHtml:function(){var i=this.posObj;var s=this.mmToPx;var n=e.map(i,"outerHTML").join("");var a=this.hid;var r=this.hrs;var h="";a.append(n).find("span").remove(".input");n=a.html();for(var l=0;l<r.length;l++){if(r[l].offsetLeft>260&&r[l].offsetTop>40){h=h+'<div style="position: absolute;left:'+(r[l].offsetLeft-260)/s+"mm;top:"+(r[l].offsetTop-40)/s+"mm;width: "+r[l].clientWidth/s+"mm;border-top: "+r[l].clientTop/s+'mm solid #0f0f0f"></div>'}}n=n+h;var o="<style>"+e.map(i,"style").join("")+"</style>";this.showHtmlCls.removeClass("hidden");this.showHtmlId.text(o+n);this.mainCon.addClass("hidden");t("body").addClass("back-c-b")},close:function(){this.showHtmlCls.addClass("hidden");this.mainCon.removeClass("hidden");t("body").removeClass("back-c-b")},calLi:function(){var i=this.pap;var t=this.mmToPx;var e=parseInt(i.css("width"));var s=parseInt(i.css("height"));var n=Math.round(e/t/5)+1;var a=Math.round(s/t/5)+1;var r="",h="",l="",o="";for(var d=0;d<n;d++){r="<li></li>"+r}for(var c=0;c<Math.round(n/2)+1;c++){h=h+"<li>"+c*10+"</li>"}for(var p=0;p<a;p++){l="<li></li>"+l}for(var f=0;f<Math.round(a/2)+1;f++){o=o+"<li>"+f*10+"</li>"}this.rulerX.html(r);this.numX.html(h);this.rulerY.html(l);this.numY.html(o);this.centerY.css("left",e/2+260+"px")},delStyle:function(i){var t=i.indexOf("class");var e=i.indexOf('px;"',t)+4;return i.substring(0,t)+i.substring(e)},paperRange:function(i,t){var e=this.pap;var s=parseInt(e.css("width"));var n=parseInt(e.css("height"));return t>260&&t<260+s&&i>40&&i<40+n},initialization:function(){this.calLi();this.bindEvent(this.eventsMap)},initializeElements:function(){var i=n.Eles;for(var e in i){if(i.hasOwnProperty(e)){this[e]=t(i[e])}}},_scanEventsMap:function(i,t){var e=/^(\S+)\s*(.*)$/;var s=t?this._delegate:this._undelegate;for(var n in i){if(i.hasOwnProperty(n)){var a=n.match(e);s(a[1],a[2],i[n].bind(this))}}},initializeOrdinaryEvents:function(i){this._scanEventsMap(i,true)},uninitializeOrdinaryEvents:function(i){this._scanEventsMap(i)},_delegate:function(i,t,e){s.on(i,t,e)},_undelegate:function(i,t,e){s.off(i,t,e)},initDrag:function(){var i=this;this.widgetDiv.draggable({snap:".center-box,.line-left,.line-top",snapMode:"inner",snapTolerance:15,start:i._dragStart,drag:i._dragging,stop:i._dragStop,zIndex:100})},initResize:function(){var i=this;this.inputResize.resizable({resize:i._resizing,stop:i._resizeStop})},uninitDrag:function(){this.widgetDiv.draggable("destroy")},uninitResize:function(){this.inputResize.resizable("destroy")},bindEvent:function(i){this.initDrag();this.initResize();this.initializeOrdinaryEvents(i)},unbindEvent:function(i){this.uninitDrag();this.uninitResize();this.uninitializeOrdinaryEvents(i)},destroy:function(){this.unbindEvent()}};i.reportCustomApplication=n;t(function(){new n})})(this,this.jQuery,this._,document);