(function(t,i,e,s){"use strict";var n=function(t){t=t||{};this.posObj={};this.mmToPx=t.mmToPx||3;this.xx=0;this.yy=0;this.initializeElements();this.eventsMap={"dblclick .title":"titledblclick","dblclick .input input":"inputdbclick","click .input span":"changeFontSize","click .make-hr a":"makehr","click .change-paper a":"changepapaer","click #cusGo":"cusGo","click #toHtml":"toHtml","click #close":"close"};this.initialization()};n.Eles={body:"body",widgetDiv:".left-widget div",inputResize:".input-resize",pap:".paper",centerY:".center-y",centerBox:".center-box",lineX:".line-x",lineY:".line-y",lineXY:".line-x .line-y",widgetUl:".left-widget ul",hr:".hr",txt:".input-group-btn button",cus:"#paper-type-cus",paperCusw:"#paper-cus-width",paperCush:"#paper-cus-height",hid:"#hidden",showHtmlCls:".showHtml",showHtmlId:"#showHtml",mainCon:"#mainCon",rulerX:".ruler-x",numX:".num-x",rulerY:".ruler-y",numY:".num-y"};var r={getCssParseInt:function(t,e){return parseInt(i(t).css(e),10)},setCenter:function(t,i,e){t.css({width:i,left:e-Math.floor(i/2)})},has:function(t,i){return t.indexOf(i)>-1},eachstr:function(t,i){var e="";for(var s=0;s<t;s++){e+=i(s)}return e},hide:function(t){i(t).addClass("hidden")},show:function(t){i(t).removeClass("hidden")},toggle:function(t){return i(t).toggleClass("hidden")}};n.prototype={constructor:n,_dragStart:function(t,i){var e=this.centerY,s=this.centerBox;if(r.has(["titleDrag","subtitleDrag"],t.target.id)){r.show(s);r.setCenter(s,r.getCssParseInt(e,"left"),i.helper.width())}else{r.hide(s)}},setPos:function(t,i,e){var s=t.id;this.posObj[s]={id:s,outerHTML:this.delStyle(t.outerHTML),style:"#"+s+"{"+i+(e||"")+"}"}},setPosStyle:function(t,i){this.posObj[t].style="#"+t+"{"+i+"}"},getMM:function(t){return t/this.mmToPx+"mm"},_dragStop:function(t,e){var s=t.target,n=s.id,a=e.offset.top,h=e.offset.left,o=i(s).next(),l=s.find(".input-resize");if(this.paperRange(a,h)){this.setPos(s,this._getPositionLT(a,h));if(r.has(["imgDescI","diagDescI"],n)){var c=r.getCssParseInt(l,"width");var u=r.getCssParseInt(l,"height");this.setPosStyle(n,this._getPositionLT(a,h),"width"+this.getMM(c)+";height:"+this.getMM(u))}this._drawNextLine(o,h,a)}else{r.hide(o)}r.hide(this.lineXY)},_getPositionLT:function(t,i){return"position:absolute;left:"+this.getMM(i-260)+";top:"+this.getMM(t-40)},_drawNextLine:function(t,i,e){var s=this.pap,n=r.getCssParseInt(s,"height"),a=r.getCssParseInt(s,"width"),h=t.find(".line-left"),o=t.find(".line-top");r.show(t);h.css({top:40,left:i,height:n,width:a-i+260+"px"});o.css({left:260,top:e,width:a,height:n-e+40+"px"})},_dragging:function(t,i){var e=this.xx,s=this.yy,n=t.target.id,a=i.offset.top,h=i.offset.left,o=i.helper.height(),l=i.helper.width(),c=r.has(["titleDrag","subtitleDrag"],n);e=c?a+Math.floor(o/2):a;s=c?h+Math.floor(l/2):h;if(this.paperRange(e,s)){r.show(this.lineXY);this.lineX.css("top",e);this.lineY.css("left",s)}else{this.lineXY.hide()}},_resizing:function(t,e){var s=t.target,n=e.size,a=i(s).offset();r.show(this.lineXY);this.lineX.css("top",+n.height+a.top);this.lineY.css("left",+n.width+a.left)},_resizeStop:function(t,e){var s=t.target,n=s.id,a=i(s).offset(),h=a.left,o=a.top,l=e.size.width,c=e.size.height;r.hide(this.lineXY);this.setPosStyle(n,this._getPositionLT(o,h),"width:"+this.getMM(l)+";height:"+this.getMM(c))},titledblclick:function(t){var i=t.target;r.toggle(r.toggle(i).next(".input"))},inputdblclick:function(t){var e=t.target;var s=i(e).parent(".input");var n=s.prev();n.html(i(e).val());n.css("font-size",i(e).css("font-size"));r.toggle(s);r.toggle(n)},changeFontSize:function(t){var e=t.target;var s=i(e).parent(".input").find("input");var n=r.getCssParseInt(s,"font-size");n=e.className==="glyphicon glyphicon-plus-sign"?n+1:n-1;s.css("font-size",n+"px")},makehr:function(t){this.widgetUl.append('<li><div class="hr '+t.target.id+'"></div></li>');this.initDrag();this.initHRResize()},initHRResize:function(){var t=this.xx;var i=this.yy;this.hr.resizable({handles:"e",minHeight:1,resize:function(e,s){r.show(this.lineXY);this.lineX.css("top",+s.size.height+t);this.lineY.css("left",+s.size.width+i)},stop:function(){r.hide(this.lineXY)}})},setPapWH:function(t,i){var e=this.mmToPx;this.pap.css({width:t*e+"px",height:i*e+"px"})},changepaper:function(t){var e=this.txt;var s=this.cus;var n=t.target.id;var a=i(t.target);var h={a4:[210,297],b5:[176,250],"16k":[184,260]};e.text(a.text());if(h[n]){var o=h[n];this.setPapWH(o[0],o[1]);r.hide(s)}if(n==="cur"){r.show(s)}this.calLi()},cusGo:function(){var t=+this.paperCusw.val();var i=+this.paperCush.val();if(t&&i){this.setPapWH(t,i);this.calLi()}},toHtml:function(){var t=this.posObj;var i=e.map(t,"outerHTML").join("");var s=this.hid;var n=this.hrs;var a="";s.append(i).find("span").remove(".input");i=s.html();for(var h=0;h<n.length;h++){var o=n[h];if(o.offsetLeft>260&&o.offsetTop>40){a+='<div style="'+this._getPositionLT(o.offsetLeft,o.offsetTop)+"width: "+this.getMM(o.clientWidth)+";border-top: "+this.getMM(o.clientTop)+' solid #0f0f0f"></div>'}}i=i+a;var l="<style>"+e.map(t,"style").join("")+"</style>";r.show(this.showHtmlCls);this.showHtmlId.text(l+i);r.hide(this.mainCon);this.body.addClass("back-c-b")},close:function(){r.hide(this.showHtmlCls);r.show(this.mainCon);this.body.removeClass("back-c-b")},calLi:function(){var t=this.pap;var i=this.mmToPx;var e=r.getCssParseInt(t,"width");var s=r.getCssParseInt(t,"height");var n=Math.round(e/i/5)+1;var a=Math.round(s/i/5)+1;var h=r.eachstr(n,u);var o=r.eachstr(Math.round(n/2),p);var l=r.eachstr(a,u);var c=r.eachstr(Math.round(a/2),p);this.rulerX.html(h);this.numX.html(o);this.rulerY.html(l);this.numY.html(c);this.centerY.css("left",e/2+260+"px");function u(){return"<li></li>"}function p(t){return"<li>"+t*10+"</li>"}},delStyle:function(t){var i=t.indexOf("class");var e=t.indexOf('px;"',i)+4;return t.substring(0,i)+t.substring(e)},paperRange:function(t,i){var e=this.pap;var s=r.getCssParseInt(e,"width");var n=r.getCssParseInt(e,"height");return i>260&&i<260+s&&t>40&&t<40+n},initialization:function(){this.calLi();this.bindEvent(this.eventsMap)},initializeElements:function(){var t=n.Eles;for(var e in t){if(t.hasOwnProperty(e)){this[e]=i(t[e])}}},_scanEventsMap:function(t,i){var e=/^(\S+)\s*(.*)$/;var s=i?this._delegate:this._undelegate;for(var n in t){if(t.hasOwnProperty(n)){var r=n.match(e);s(r[1],r[2],t[n].bind(this))}}},initializeOrdinaryEvents:function(t){this._scanEventsMap(t,true)},uninitializeOrdinaryEvents:function(t){this._scanEventsMap(t)},_delegate:function(t,i,e){s.on(t,i,e)},_undelegate:function(t,i,e){s.off(t,i,e)},initDrag:function(){var t=this;this.widgetDiv.draggable({snap:".center-box,.line-left,.line-top",snapMode:"inner",snapTolerance:15,start:t._dragStart,drag:t._dragging,stop:t._dragStop,zIndex:100})},initResize:function(){var t=this;this.inputResize.resizable({resize:t._resizing,stop:t._resizeStop})},uninitDrag:function(){this.widgetDiv.draggable("destroy")},uninitResize:function(){this.inputResize.resizable("destroy");this.hr.resizable("destroy")},bindEvent:function(t){this.initDrag();this.initResize();this.initializeOrdinaryEvents(t)},unbindEvent:function(t){this.uninitDrag();this.uninitResize();this.uninitializeOrdinaryEvents(t)},destroy:function(){this.unbindEvent()}};t.reportCustomApplication=n;i(function(){new n})})(this,this.jQuery,this._,document);