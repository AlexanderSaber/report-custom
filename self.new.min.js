(function(t,e,i,s){"use strict";var n=function(t){t=t||{};this.posObj={};this.mmToPx=t.mmToPx||3;this.xx=0;this.yy=0;this.initializeElements();this.eventsMap={"dblclick .title":"titledblclick","dblclick .input input":"inputdbclick","click .input span":"changeFontSize","click .make-hr a":"makehr","click .change-paper a":"changepapaer","click #cusGo":"cusGo","click #toHtml":"toHtml","click #close":"close"};this.initialization()};n.Eles={pap:".paper",centerY:"center-y"};n.prototype={constructor:n,_dragStart:function(t,i){var s=this.centerY;if(t.target.id=="titleDrag"||t.target.id=="subtitleDrag"){e(".center-box").removeClass("hidden").css({width:i.helper.width(),left:parseInt(s.css("left"))-Math.floor(i.helper.width()/2)})}else{e(".center-box").addClass("hidden")}},_dragStop:function(t,i){var s=this.pap,n=this.mmToPx,a=this.posObj,r=t.target;if(this.paperRange(i.offset.top,i.offset.left)){a[t.target.id]={id:t.target.id,outerHTML:this.delStyle(t.target.outerHTML),style:"#"+t.target.id+"{position: absolute;left:"+(i.offset.left-260)/n+"mm;top:"+(i.offset.top-40)/n+"mm;}"};if(t.target.id=="imgDescI"||t.target.id=="diagDescI"){var o=parseInt(e(r).find(".input-resize").css("width"));var d=parseInt(e(r).find(".input-resize").css("height"));a[t.target.id].style="#"+t.target.id+"{position: absolute;left:"+(i.offset.left-260)/n+"mm;top:"+(i.offset.top-40)/n+"mm;width:"+o/n+"mm;height:"+d/n+"mm}"}e(r).next().removeClass("hidden");e(r).next().find(".line-left").css({top:40,left:i.offset.left,height:s.css("height"),width:parseInt(s.css("width"))-i.offset.left+260+"px"});e(r).next().find(".line-top").css({left:260,top:i.offset.top,width:s.css("width"),height:parseInt(s.css("height"))-i.offset.top+40+"px"})}else{e(r).next().addClass("hidden")}e(".line-x, .line-y").addClass("hidden")},_dragging:function(t,i){var s=this.xx,n=this.yy;if(t.target.id=="titleDrag"||t.target.id=="subtitleDrag"){s=i.offset.top+Math.floor(i.helper.height()/2);n=i.offset.left+Math.floor(i.helper.width()/2)}else{s=i.offset.top;n=i.offset.left}if(this.paperRange(s,n)){e(".line-x").removeClass("hidden").css("top",s);e(".line-y").removeClass("hidden").css("left",n)}else{e(".line-x, .line-y").addClass("hidden")}},_resizing:function(t,i){var s=t.target;e(".line-x").removeClass("hidden").css("top",+i.size.height+e(s).offset().top);e(".line-y").removeClass("hidden").css("left",+i.size.width+e(s).offset().left)},_resizeStop:function(t,i){var s=this.mmToPx,n=this.posObj,a=t.target;e(".line-x").addClass("hidden");e(".line-y").addClass("hidden");t=e(a).parent()[0];n[t.id].style="#"+t.id+"{position: absolute;left:"+(e(a).offset().left-260)/s+"mm;top:"+(e(a).offset().top-40)/s+"mm;width:"+i.size.width/s+"mm;height:"+i.size.height/s+"mm}"},titledblclick:function(t){var i=t.target;e(i).toggleClass("hidden");e(i).next(".input").toggleClass("hidden")},inputdblclick:function(t){var i=t.target;e(i).parent(".input").prev()[0].innerHTML=e(i)[0].value;e(i).parent(".input").prev().css("font-size",e(i).css("font-size"));e(i).parent(".input").toggleClass("hidden");e(i).parent(".input").prev().toggleClass("hidden")},changeFontSize:function(t){var i=t.target;var s=parseInt(e(i).parent(".input").find("input").css("font-size"));if(e(i)[0].className=="glyphicon glyphicon-plus-sign"){s=parseInt(s)+1+"px"}else{s=parseInt(s)-1+"px"}e(i).parent(".input").find("input").css("font-size",s)},makehr:function(t){var i=e(".left-widget ul");var s;switch(t.target.id){case"thin":s='<li><div class="hr thin"></div></li>';i.append(s);break;case"middle":s='<li><div class="hr middle"></div></li>';i.append(s);break;case"thick":s='<li><div class="hr thick"></div></li>';i.append(s);break}this.initDrag();this.initHRResize()},initHRResize:function(){var t=this.xx;var i=this.yy;e(".hr").resizable({handles:"e",minHeight:1,resize:function(s,n){e(".line-x").removeClass("hidden").css("top",+n.size.height+t);e(".line-y").removeClass("hidden").css("left",+n.size.width+i)},stop:function(){e(".line-x").addClass("hidden");e(".line-y").addClass("hidden")}})},changepaper:function(t){var i=e(".input-group-btn button");var s=e("#paper-type-cus");var n=this.mmToPx;var a=this.pap;i[0].textContent=t.target.textContent;switch(t.target.id){case"a4":a.css({width:210*n+"px",height:297*n+"px"});s.addClass("hidden");break;case"b5":a.css({width:176*n+"px",height:250*n+"px"});s.addClass("hidden");break;case"16k":a.css({width:184*n+"px",height:260*n+"px"});s.addClass("hidden");break;case"cus":s.removeClass("hidden");break}this.calLi()},cusGo:function(){var t=this.pap;var i=+e("#paper-cus-width")[0].value;var s=+e("#paper-cus-height")[0].value;if(i&&s){t.css({width:i*3+"px",height:s*3+"px"});this.calLi()}},toHtml:function(){var t=this.posObj;var s=this.mmToPx;var n=i.map(t,"outerHTML").join("");var a=e("#hidden");var r=e(".hr");var o="";a.append(n).find("span").remove(".input");n=a.html();for(var d=0;d<r.length;d++){if(r[d].offsetLeft>260&&r[d].offsetTop>40){o=o+'<div style="position: absolute;left:'+(r[d].offsetLeft-260)/s+"mm;top:"+(r[d].offsetTop-40)/s+"mm;width: "+r[d].clientWidth/s+"mm;border-top: "+r[d].clientTop/s+'mm solid #0f0f0f"></div>'}}n=n+o;var l="<style>"+i.map(t,"style").join("")+"</style>";e(".showHtml").removeClass("hidden");e("#showHtml").text(l+n);e("#mainCon").addClass("hidden");e("body").addClass("back-c-b")},close:function(){e(".showHtml").addClass("hidden");e("#mainCon").removeClass("hidden");e("body").removeClass("back-c-b")},calLi:function(){var t=this.pap;var i=this.mmToPx;var s=parseInt(t.css("width"));var n=parseInt(t.css("height"));var a=Math.round(s/i/5)+1;var r=Math.round(n/i/5)+1;var o="",d="",l="",h="";for(var p=0;p<a;p++){o="<li></li>"+o}for(var c=0;c<Math.round(a/2)+1;c++){d=d+"<li>"+c*10+"</li>"}for(var f=0;f<r;f++){l="<li></li>"+l}for(var u=0;u<Math.round(r/2)+1;u++){h=h+"<li>"+u*10+"</li>"}e(".ruler-x")[0].innerHTML=o;e(".num-x")[0].innerHTML=d;e(".ruler-y")[0].innerHTML=l;e(".num-y")[0].innerHTML=h;e(".center-y").css("left",s/2+260+"px")},delStyle:function(t){var e=t.indexOf("class");var i=t.indexOf('px;"',e)+4;return t.substring(0,e)+t.substring(i)},paperRange:function(t,e){var i=this.pap;var s=parseInt(i.css("width"));var n=parseInt(i.css("height"));return e>260&&e<260+s&&t>40&&t<40+n},initialization:function(){this.calLi();this.bindEvent(this.eventsMap)},initializeElements:function(){var t=n.Eles;for(var i in t){if(t.hasOwnProperty(i)){this[i]=e(t[i])}}},_scanEventsMap:function(t,e){var i=/^(\S+)\s*(.*)$/;var s=e?this._delegate:this._undelegate;for(var n in t){if(t.hasOwnProperty(n)){var a=n.match(i);s(a[1],a[2],t[n].bind(this))}}},initializeOrdinaryEvents:function(t){this._scanEventsMap(t,true)},uninitializeOrdinaryEvents:function(t){this._scanEventsMap(t)},_delegate:function(t,e,i){s.on(t,e,i)},_undelegate:function(t,e,i){s.off(t,e,i)},initDrag:function(){var t=this;e(".left-widget div").draggable({snap:".center-box,.line-left,.line-top",snapMode:"inner",snapTolerance:15,start:t._dragStart,drag:t._dragging,stop:t._dragStop,zIndex:100})},initResize:function(){var t=this;e(".input-resize").resizable({resize:t._resizing,stop:t._resizeStop})},uninitDrag:function(){e(".left-widget div").draggable("destroy")},uninitResize:function(){e(".input-resize").resizable("destroy")},bindEvent:function(t){this.initDrag();this.initResize();this.initializeOrdinaryEvents(t)},unbindEvent:function(t){this.uninitDrag();this.uninitResize();this.uninitializeOrdinaryEvents(t)},destroy:function(){this.unbindEvent()}};t.reportCustomApplication=n;e(function(){new n})})(this,this.jQuery,this._,document);